= Documentation v0.3 â€“ Gestion des demandes et les recherche optimisÃ©s
v0.3, Janvier 2025
:pdf-theme: default
:pdf-fontsdir: GEMS_DIR/asciidoctor-pdf/data/fonts
:pdf-page-size: A4
:pdf-page-layout: portrait
:pdf-scripts: scripts
:toc:
:toc-title: Sommaire

== ğŸ¯ Introduction

La version v0.3 marque une avancÃ©e majeure pour lâ€™application en intÃ©grant un **systÃ¨me de notifications en temps rÃ©el**, une **gestion fluide des demandes dâ€™intÃ©rÃªt**, et une **expÃ©rience utilisateur optimisÃ©e**.

Cette documentation couvre :

. Les nouvelles fonctionnalitÃ©s dÃ©veloppÃ©es.
. Les **flux utilisateurs** pour chaque action clÃ©.
. Les **endpoints backend** utilisÃ©s.
. Lâ€™**impact mÃ©tier** et la valeur ajoutÃ©e des amÃ©liorations.
. Un **diagramme de sÃ©quence UML** pour illustrer le workflow.

---

== ğŸš€ Grandes FonctionnalitÃ©s

=== ğŸ“Œ 2.1 Gestion des Demandes d'IntÃ©rÃªt & Notifications en Temps RÃ©el

**Description**

Cette fonctionnalitÃ© regroupe tout le flux des demandes d'intÃ©rÃªt, y compris les notifications en temps rÃ©el. Les utilisateurs peuvent envoyer et recevoir des demandes d'intÃ©rÃªt, puis Ãªtre notifiÃ©s de l'acceptation ou du refus de la demande en temps rÃ©el.

**Flux Utilisateur**

1. **Envoi d'une Demande d'IntÃ©rÃªt**
    - L'utilisateur intÃ©ressÃ© clique sur "Demander".
    - La demande est enregistrÃ©e en base (via **POST /interests**).
    - Une notification en temps rÃ©el est envoyÃ©e au proposeur.
2. **Consultation des Demandes d'IntÃ©rÃªt**
    - Le proposeur accÃ¨de Ã  "Mes IntÃ©rÃªts ReÃ§us".
    - Il voit la demande et peut lâ€™accepter ou la refuser.
3. **Notifications et Actions en Temps RÃ©el**
    - Si la demande est acceptÃ©e, le demandeur est notifiÃ© avec les coordonnÃ©es du proposeur.
    - Si la demande est refusÃ©e, le demandeur est informÃ© de la dÃ©cision.

**Endpoints Backend**
|===
| MÃ©thode | Endpoint | Description
| **POST** | `/interests` | CrÃ©er une demande dâ€™intÃ©rÃªt.
| **GET** | `/interests/received/:userId` | RÃ©cupÃ©rer les demandes reÃ§ues.
| **GET** | `/interests/sent/:userId` | RÃ©cupÃ©rer les demandes envoyÃ©es.
| **PUT** | `/interests/:id` | Accepter ou refuser une demande.
| **GET** | `/notifications/:userId` | RÃ©cupÃ¨re toutes les notifications dâ€™un utilisateur.
| **POST** | `/notifications` | CrÃ©e une nouvelle notification.
| **DELETE** | `/notifications/:notifId` | Supprime une notification spÃ©cifique.
| **DELETE** | `/notifications/all/:userId` | Supprime toutes les notifications dâ€™un utilisateur.
|===

**Diagramme de SÃ©quence : Demande d'IntÃ©rÃªt et Notifications**
[plantuml, demande-notification-sequence, svg]
----
@startuml
participant "Utilisateur IntÃ©ressÃ© (par l'annonce)" as UI
participant "Frontend (React)" as FE
participant "Backend API" as API
participant "Base de DonnÃ©es" as DB
participant "WebSockets" as WS
participant "Proposeur (de l'annonce)" as P

== ğŸ“© 1. L'utilisateur envoie une demande dâ€™intÃ©rÃªt ==
UI -> FE: Clique sur "Demander"
FE -> API: **POST** /interests (proposition_id, interested_user_id)
API -> DB: ğŸ” VÃ©rifie que la proposition existe
DB --> API: âœ… OK
API -> DB: ğŸ“ Enregistre la demande avec statut **"pending"**
DB --> API: âœ… OK (id_interet)
API -> WS: ğŸ“¡ **Ã‰met une notification au proposeur**
WS --> P: ğŸ”” "Nouvelle demande reÃ§ue"

== ğŸ“¥ 2. Le proposeur consulte ses demandes ==
P -> FE: AccÃ¨de Ã  "Mes IntÃ©rÃªts ReÃ§us"
FE -> API: **GET** /interests/received/:userId
API -> DB: ğŸ” RÃ©cupÃ¨re toutes les demandes associÃ©es Ã  lâ€™utilisateur
DB --> API: ğŸ“‹ Renvoie les demandes (id, titre, utilisateur intÃ©ressÃ©)
API --> FE: ğŸ–¥ï¸ Affiche la liste des demandes

== âœ… 3A. Le proposeur **accepte** la demande ==
P -> FE: Clique sur "**Accepter**"
FE -> API: **PUT** /interests/:id (status: accepted)
API -> DB: âœ… Met Ã  jour le statut en **"accepted"**
DB --> API: âœ… OK
API -> WS: ğŸ“¡ **Ã‰met une notification avec le statut acceptÃ©**
WS --> UI: ğŸ”” "**ğŸ‰ Votre demande a Ã©tÃ© acceptÃ©e ! Voici les contacts ğŸ“§ğŸ“**"

== âŒ 3B. Le proposeur **refuse** la demande ==
P -> FE: Clique sur "**Refuser**"
FE -> API: **PUT** /interests/:id (status: rejected)
API -> DB: âŒ Met Ã  jour le statut en **"rejected"**
DB --> API: âœ… OK
API -> WS: ğŸ“¡ **Ã‰met une notification avec le statut refusÃ©**
WS --> UI: ğŸ”” "**âŒ Votre demande a Ã©tÃ© refusÃ©e.**"
@enduml
----

---

=== ğŸ“Œ 2.2 Recherche de Propositions

**Description**

Cette fonctionnalitÃ© permet aux utilisateurs de rechercher des propositions en fonction de plusieurs critÃ¨res : mots-clÃ©s, catÃ©gorie et distance gÃ©ographique.

**Flux Utilisateur**

1. L'utilisateur entre des mots-clÃ©s et sÃ©lectionne une catÃ©gorie de service.
2. Le systÃ¨me effectue une recherche floue sur les titres et descriptions des propositions.
3. Le systÃ¨me filtre les propositions par catÃ©gorie sÃ©lectionnÃ©e.
4. Le systÃ¨me calcule la distance gÃ©ographique entre l'utilisateur et les propositions.
5. Les rÃ©sultats sont affichÃ©s, triÃ©s par proximitÃ© gÃ©ographique.

**Endpoints Backend**
|===
| MÃ©thode | Endpoint | Description
| **GET** | `/propositions/search` | Recherche des propositions en fonction des mots-clÃ©s, catÃ©gorie et distance.
|===

**Diagramme de SÃ©quence : Recherche de Propositions**
[plantuml, recherche-sequence, svg]
----
@startuml
actor "Utilisateur" as User
participant "Frontend (React)" as FE
participant "Backend API" as API
participant "Base de DonnÃ©es" as DB
participant "Fuse.js" as Fuse
participant "WebSocket (si notifications)" as WS

== 1. L'utilisateur effectue une recherche ==
User -> FE: Entre des mots-clÃ©s et sÃ©lectionne une catÃ©gorie
FE -> API: **GET** /propositions/search (mots-clÃ©s, catÃ©gorie, utilisateur_id)
API -> DB: ğŸ” RÃ©cupÃ¨re les propositions en fonction de la catÃ©gorie
DB --> API: ğŸ“‹ Liste des propositions filtrÃ©es par catÃ©gorie
API -> Fuse: Utilise Fuse.js pour recherche floue sur 'title' et 'description'
Fuse --> API: ğŸ“‹ Liste des propositions correspondant aux mots-clÃ©s
API -> DB: ğŸ” RÃ©cupÃ¨re les coordonnÃ©es de l'utilisateur (latitude, longitude)
DB --> API: ğŸ“‹ CoordonnÃ©es de l'utilisateur
API -> DB: ğŸ” Calcule la distance entre l'utilisateur et chaque proposition
DB --> API: ğŸ“‹ Liste des propositions avec distances
API -> FE: ğŸ–¥ï¸ Affiche les rÃ©sultats avec distance et pertinence
FE --> User: Montre les propositions filtrÃ©es

@enduml
----

=== ğŸ“Œ 2.3 Recherche AvancÃ©e des Ã‰vÃ©nements

**Description**

Cette fonctionnalitÃ© permet aux utilisateurs de rechercher des Ã©vÃ©nements en fonction de plusieurs critÃ¨res : mots-clÃ©s, catÃ©gorie et ville. GrÃ¢ce Ã  la bibliothÃ¨que **Fuse.js**, la recherche est floue et permet de retrouver des Ã©vÃ©nements qui correspondent partiellement aux mots-clÃ©s recherchÃ©s, mÃªme en cas d'erreur de frappe.

Le processus de recherche est optimisÃ© pour une expÃ©rience utilisateur fluide :

1. L'utilisateur saisit un mot-clÃ© (et optionnellement, sÃ©lectionne une catÃ©gorie ou une ville).
2. Le systÃ¨me filtre les Ã©vÃ©nements en fonction de la catÃ©gorie et de la ville sÃ©lectionnÃ©es.
3. La recherche floue est effectuÃ©e sur les titres et descriptions des Ã©vÃ©nements en utilisant Fuse.js, avec un seuil de pertinence rÃ©glable pour affiner les rÃ©sultats.
4. Les rÃ©sultats sont retournÃ©s et triÃ©s par pertinence.

**Flux Utilisateur**

1. L'utilisateur entre un mot-clÃ© de recherche et, si souhaitÃ©, sÃ©lectionne une catÃ©gorie et/ou une ville.
2. La recherche floue est effectuÃ©e dans les titres et descriptions des Ã©vÃ©nements.
3. Les Ã©vÃ©nements sont filtrÃ©s en fonction de la catÃ©gorie et de la ville, si spÃ©cifiÃ©s.
4. Les rÃ©sultats de recherche sont retournÃ©s, affichÃ©s par pertinence.
5. L'utilisateur peut cliquer sur un Ã©vÃ©nement pour consulter son dÃ©tail.

**Endpoints Backend**
|===
| MÃ©thode | Endpoint | Description
| **GET** | `api/events/search` | Recherche des Ã©vÃ©nements en fonction des mots-clÃ©s, catÃ©gorie et ville.
| **GET** | `api/events/:id` | RÃ©cupÃ¨re les dÃ©tails dâ€™un Ã©vÃ©nement spÃ©cifique.
|===

**Diagramme de SÃ©quence : Recherche AvancÃ©e des Ã‰vÃ©nements**
[plantuml, recherche-avancee-sequence, svg]
----
@startuml
actor "Utilisateur" as User
participant "Frontend (React)" as FE
participant "Backend API" as API
participant "Base de DonnÃ©es" as DB
participant "Fuse.js" as Fuse

== 1. L'utilisateur effectue une recherche ==
User -> FE: Saisit un mot-clÃ© et sÃ©lectionne une catÃ©gorie ou une ville
FE -> API: **GET** api//events/search (mot-clÃ©, catÃ©gorie, ville)
API -> DB: ğŸ” RÃ©cupÃ¨re tous les Ã©vÃ©nements en fonction de la catÃ©gorie et de la ville
DB --> API: ğŸ“‹ Liste des Ã©vÃ©nements filtrÃ©s
API -> Fuse: Recherche floue sur 'title' et 'description'
Fuse --> API: ğŸ“‹ Liste des Ã©vÃ©nements correspondant aux mots-clÃ©s
API -> FE: ğŸ–¥ï¸ Affiche les rÃ©sultats de la recherche
FE --> User: Montre les Ã©vÃ©nements filtrÃ©s par pertinence

== 2. L'utilisateur consulte un Ã©vÃ©nement ==
User -> FE: Clique sur un Ã©vÃ©nement
FE -> API: **GET** api/events/:id
API -> DB: ğŸ” RÃ©cupÃ¨re les dÃ©tails de lâ€™Ã©vÃ©nement avec lâ€™ID
DB --> API: ğŸ“‹ DÃ©tails de lâ€™Ã©vÃ©nement
API -> FE: ğŸ–¥ï¸ Affiche les dÃ©tails de lâ€™Ã©vÃ©nement
FE --> User: Montre les dÃ©tails de lâ€™Ã©vÃ©nement

@enduml
----

---

== ğŸš€ Petites FonctionnalitÃ©s

=== ğŸ“Œ 2.1 Page â€œMes Demandes EnvoyÃ©esâ€ ğŸ“¤

**Description**

Ajout dâ€™une nouvelle section permettant aux utilisateurs de **suivre leurs demandes** et voir si elles sont **acceptÃ©es ou refusÃ©es**.

**Flux Utilisateur**

1. Lâ€™utilisateur consulte **la section â€œMes demandes envoyÃ©esâ€**.
2. Il voit **toutes ses demandes** avec leur statut actuel.
3. **Si la demande est acceptÃ©e**, il accÃ¨de aux **coordonnÃ©es du proposeur**.

**Endpoints Backend**
|===
| MÃ©thode | Endpoint | Description
| **GET** | `/interests/sent/:userId` | Retourne les demandes envoyÃ©es par lâ€™utilisateur.
| **PUT** | `/interests/:id` | Met Ã  jour le statut dâ€™une demande.
|===

---

=== ğŸ“Œ 2.2 Notifications en Temps RÃ©el ğŸ””

**Description**

Les notifications sont envoyÃ©es en temps rÃ©el Ã  lâ€™utilisateur lorsquâ€™une action importante se produit (acceptation/refus dâ€™une demande, etc.). Cela permet une interaction fluide et rÃ©active avec lâ€™application.

**Flux Utilisateur**

1. Lâ€™utilisateur effectue une action qui gÃ©nÃ¨re une notification.
2. Une notification apparaÃ®t instantanÃ©ment dans le panneau des notifications.
3. Lâ€™utilisateur peut la consulter et la supprimer.

**Endpoints Backend**
|===
| MÃ©thode | Endpoint | Description
| **POST** | `/notifications` | CrÃ©e une nouvelle notification.
| **GET** | `/notifications/:userId` | RÃ©cupÃ¨re toutes les notifications dâ€™un utilisateur.
| **DELETE** | `/notifications/:notifId` | Supprime une notification spÃ©cifique.
| **DELETE** | `/notifications/all/:userId` | Supprime toutes les notifications dâ€™un utilisateur.
|===

---

=== ğŸ“Œ 2.3 AmÃ©liorations UX/UI ğŸ¨

Lâ€™application a Ã©tÃ© **remaniÃ©e graphiquement** pour une **meilleure expÃ©rience utilisateur** :

* âœ… **Nouvelle navbar fixe** avec **navigation fluide**.
* âœ… **Popup de notifications stylÃ©e** avec **mise en forme propre**.
* âœ… **Suppression du bleu flashy** et **adoption dâ€™un design plus Ã©purÃ©**.
* âœ… **Animations CSS** pour un rendu **plus dynamique**.
* âœ… **Espacement et marges ajustÃ©s** pour **une meilleure lisibilitÃ©**.

---
== ğŸ“Š Impact MÃ©tier & Valeur AjoutÃ©e

|===
| FonctionnalitÃ© | Valeur AjoutÃ©e
| ğŸ”” Notifications en temps rÃ©el | Permet aux utilisateurs dâ€™Ãªtre informÃ©s instantanÃ©ment des actions importantes.
| ğŸ“© Gestion des demandes dâ€™intÃ©rÃªt | Simplifie lâ€™interaction entre utilisateurs, rendant le processus plus intuitif.
| ğŸ“¤ Suivi des demandes envoyÃ©es | Apporte de la transparence sur lâ€™Ã©tat des interactions.
| ğŸ¨ ExpÃ©rience utilisateur amÃ©liorÃ©e | Favorise lâ€™adoption de la plateforme grÃ¢ce Ã  une interface plus intuitive et agrÃ©able.
| ğŸ§ Recherche avancÃ©e des Ã©vÃ©nements | Permet une recherche rapide et prÃ©cise des Ã©vÃ©nements grÃ¢ce Ã  la recherche floue, mÃªme avec des erreurs typographiques.
|===

== âœ… Tests & Validation

* **Notifications en temps rÃ©el** : Fonctionnent sans latence.
* **Gestion des statuts (pending, accepted, rejected)** : Bien mise Ã  jour en base.
* **UI et UX fluides** : Interface rÃ©active et intuitive.
